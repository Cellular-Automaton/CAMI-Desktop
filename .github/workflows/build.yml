name: Build/release

on:
  release:
    types: [published]
permissions:
  contents: write

jobs:
  release:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        # not package for mac
        os: [ubuntu-latest, windows-latest]
        include:
          - directory: cami-front-linux-x64
            os: ubuntu-latest
            name: cami-linux
          - directory: cami-front-win32-x64
            os: windows-latest
            name: cami-windows

    steps:
      - name: Check out Git repository
        uses: actions/checkout@v4

      - name: Install Node.js, NPM and Yarn
        uses: actions/setup-node@v4

      - name: install dependencies
        run: npm install

      - name: publish
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: npm run package

      - name: Compress releases
        uses: thedoctor0/zip-release@0.7.5
        with:
          type: "zip"
          directory: out/${{matrix.directory}}
          filename: ../../${{matrix.name}}.zip
          exclusions: "*.git* /*node_modules/* .editorconfig"

      - name: publish & upload artifact
        uses: nanoufo/action-upload-artifacts-and-release-assets@v2
        with:
          path: |
            ${{matrix.name}}.zip
          if-no-files-found: warn
          upload-release-files: true
          release-upload-url: ${{ github.event.release.upload_url }}
